# OmopSketch

The goal of OmopSketch is to characterise and visualise an OMOP CDM
instance to asses if it meets the necessary criteria to answer a
specific clinical question and conduct a certain study.

## Installation

You can install the development version of OmopSketch from
[GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("OHDSI/OmopSketch")
```

## Example

Let’s start by creating a cdm object using the Eunomia GiBleed mock
dataset:

``` r
library(duckdb)
#> Loading required package: DBI
library(dplyr, warn.conflicts = FALSE)
library(OmopSketch)

cdm <- omock::mockCdmFromDataset(datasetName = "GiBleed", source = "duckdb")
#> ℹ Reading GiBleed tables.
#> ℹ Adding drug_strength table.
#> ℹ Creating local <cdm_reference> object.
#> ℹ Inserting <cdm_reference> into duckdb.
cdm
#> 
#> ── # OMOP CDM reference (duckdb) of GiBleed ────────────────────────────────────
#> • omop tables: care_site, cdm_source, concept, concept_ancestor, concept_class,
#> concept_relationship, concept_synonym, condition_era, condition_occurrence,
#> cost, death, device_exposure, domain, dose_era, drug_era, drug_exposure,
#> drug_strength, fact_relationship, location, measurement, metadata, note,
#> note_nlp, observation, observation_period, payer_plan_period, person,
#> procedure_occurrence, provider, relationship, source_to_concept_map, specimen,
#> visit_detail, visit_occurrence, vocabulary
#> • cohort tables: -
#> • achilles tables: -
#> • other tables: -
```

### Snapshot

We first create a snapshot of our database. This will allow us to track
when the analysis has been conducted and capture details about the CDM
version or the data release.

``` r
summariseOmopSnapshot(cdm) |>
  tableOmopSnapshot(type = "flextable")
```

![](reference/figures/README-unnamed-chunk-3-1.png)

### Characterise the clinical tables

Once we have collected the snapshot information, we can start
characterising the clinical tables of the CDM. By using
[`summariseClinicalRecords()`](https://OHDSI.github.io/OmopSketch/reference/summariseClinicalRecords.md)
and
[`tableClinicalRecords()`](https://OHDSI.github.io/OmopSketch/reference/tableClinicalRecords.md),
we can easily visualise the main characteristics of specific clinical
tables.

``` r
summariseClinicalRecords(cdm, c("condition_occurrence", "drug_exposure")) |>
  tableClinicalRecords(type = "flextable")
#> ℹ Adding variables of interest to condition_occurrence.
#> ℹ Summarising records per person in condition_occurrence.
#> ℹ Summarising subjects not in person table in condition_occurrence.
#> ℹ Summarising records in observation in condition_occurrence.
#> ℹ Summarising records with start before birth date in condition_occurrence.
#> ℹ Summarising records with end date before start date in condition_occurrence.
#> ℹ Summarising domains in condition_occurrence.
#> ℹ Summarising standard concepts in condition_occurrence.
#> ℹ Summarising source vocabularies in condition_occurrence.
#> ℹ Summarising concept types in condition_occurrence.
#> ℹ Summarising missing data in condition_occurrence.
#> ℹ Adding variables of interest to drug_exposure.
#> ℹ Summarising records per person in drug_exposure.
#> ℹ Summarising subjects not in person table in drug_exposure.
#> ℹ Summarising records in observation in drug_exposure.
#> ℹ Summarising records with start before birth date in drug_exposure.
#> ℹ Summarising records with end date before start date in drug_exposure.
#> ℹ Summarising domains in drug_exposure.
#> ℹ Summarising standard concepts in drug_exposure.
#> ℹ Summarising source vocabularies in drug_exposure.
#> ℹ Summarising concept types in drug_exposure.
#> ℹ Summarising missing data in drug_exposure.
```

![](reference/figures/README-unnamed-chunk-4-1.png)

### Characterise the observation period

After visualising the main characteristics of our clinical tables, we
can explore the observation period details. You can visualise and
explore the characteristics of the observation period per each
individual in the database using
[`summariseObservationPeriod()`](https://OHDSI.github.io/OmopSketch/reference/summariseObservationPeriod.md).

``` r
summariseObservationPeriod(cdm) |>
  tableObservationPeriod(type = "flextable")
#> Warning: ! There are 2649 individuals not included in the person table.
```

![](reference/figures/README-unnamed-chunk-5-1.png)

Or if visualisation is preferred, you can easily build a histogram to
explore how many participants have more than one observation period.

``` r
summariseObservationPeriod(cdm) |>
  plotObservationPeriod(colour = "observation_period_ordinal")
#> Warning: ! There are 2649 individuals not included in the person table.
```

![](reference/figures/README-unnamed-chunk-6-1.png)

### Explore trends over time

We can also explore trends over time using
[`summariseTrend()`](https://OHDSI.github.io/OmopSketch/reference/summariseTrend.md).

``` r
summariseTrend(cdm, event = c("condition_occurrence", "drug_exposure"), output = "record",  interval = "years") |>
  plotTrend(facet = "omop_table", colour = "cdm_name")
```

![](reference/figures/README-unnamed-chunk-7-1.png)

### Characterise the concepts

OmopSketch also provides functions to explore the concepts in the
dataset.

``` r
summariseConceptIdCounts(cdm, omopTableName = "drug_exposure") |>
  tableTopConceptCounts()
```

[TABLE]

Top 10 concepts in drug_exposure table

### Characterise the cdm

To obtain and explore a complete characterisation of a cdm, you can use
the OmopSketch functions
[`databaseCharacteristics()`](https://OHDSI.github.io/OmopSketch/reference/databaseCharacteristics.md)
and
[`shinyCharacteristics()`](https://OHDSI.github.io/OmopSketch/reference/shinyCharacteristics.md).
These functions allow you to generate and interactively explore detailed
summaries of your database. To see an example of the outputs produced,
explore the characterisation of several synthetic datasets
[here](https://dpa-pde-oxford.shinyapps.io/OmopSketchCharacterisation/).

As seen, OmopSketch offers multiple functionalities to provide a general
overview of a database. Additionally, it includes more tools and
arguments that allow for deeper exploration, helping to assess the
database’s suitability for specific research studies. For further
information, please refer to the vignettes.

# Package index

### Snapshots

Create snapshots of OMOP databases

- [`summariseOmopSnapshot()`](https://OHDSI.github.io/OmopSketch/reference/summariseOmopSnapshot.md)
  : Summarise a cdm_reference object creating a snapshot with the
  metadata of the cdm_reference object.
- [`tableOmopSnapshot()`](https://OHDSI.github.io/OmopSketch/reference/tableOmopSnapshot.md)
  : Create a visual table from a summarise_omop_snapshot result.

### Clinical Tables

Summarise and plot tables in the OMOP Common Data Model

- [`summariseClinicalRecords()`](https://OHDSI.github.io/OmopSketch/reference/summariseClinicalRecords.md)
  : Summarise an omop table from a cdm object. You will obtain
  information related to the number of records, number of subjects,
  whether the records are in observation, number of present domains,
  number of present concepts, missing data and inconsistencies in start
  date and end date
- [`tableClinicalRecords()`](https://OHDSI.github.io/OmopSketch/reference/tableClinicalRecords.md)
  : Create a visual table from a summariseClinicalRecord() output.
- [`summariseMissingData()`](https://OHDSI.github.io/OmopSketch/reference/summariseMissingData.md)
  : Summarise missing data in omop tables
- [`tableMissingData()`](https://OHDSI.github.io/OmopSketch/reference/tableMissingData.md)
  : Create a visual table from a summariseMissingData() result.

### Observation Periods

Summarise and plot the observation period table in the OMOP Common Data
Model

- [`summarisePerson()`](https://OHDSI.github.io/OmopSketch/reference/summarisePerson.md)
  : Summarise the person table

- [`tablePerson()`](https://OHDSI.github.io/OmopSketch/reference/tablePerson.md)
  :

  Visualise the results of
  [`summarisePerson()`](https://OHDSI.github.io/OmopSketch/reference/summarisePerson.md)
  into a table

- [`summariseObservationPeriod()`](https://OHDSI.github.io/OmopSketch/reference/summariseObservationPeriod.md)
  : Summarise the observation period table getting some overall
  statistics in a summarised_result object.

- [`plotObservationPeriod()`](https://OHDSI.github.io/OmopSketch/reference/plotObservationPeriod.md)
  : Create a plot from the output of summariseObservationPeriod().

- [`tableObservationPeriod()`](https://OHDSI.github.io/OmopSketch/reference/tableObservationPeriod.md)
  : Create a visual table from a summariseObservationPeriod() result.

### Counts

Summarise concept code use in the OMOP Common Data Model

- [`summariseConceptIdCounts()`](https://OHDSI.github.io/OmopSketch/reference/summariseConceptIdCounts.md)
  : Summarise concept use in patient-level data. Only concepts recorded
  during observation period are counted.

- [`tableConceptIdCounts()`](https://OHDSI.github.io/OmopSketch/reference/tableConceptIdCounts.md)
  : Create a visual table from a summariseConceptIdCounts() result.

- [`tableTopConceptCounts()`](https://OHDSI.github.io/OmopSketch/reference/tableTopConceptCounts.md)
  :

  Create a visual table of the most common concepts from
  [`summariseConceptIdCounts()`](https://OHDSI.github.io/OmopSketch/reference/summariseConceptIdCounts.md)
  output. This function takes a `summarised_result` object and generates
  a formatted table highlighting the most frequent concepts.

### Temporal Trends

Summarise and plot temporal trends in tables in the OMOP Common Data
Model

- [`summariseTrend()`](https://OHDSI.github.io/OmopSketch/reference/summariseTrend.md)
  : Summarise temporal trends in OMOP tables
- [`tableTrend()`](https://OHDSI.github.io/OmopSketch/reference/tableTrend.md)
  : Create a visual table from a summariseTrend() result.
- [`plotTrend()`](https://OHDSI.github.io/OmopSketch/reference/plotTrend.md)
  : Create a ggplot2 plot from the output of summariseTrend().

### Mock Database

Create a mock database to test the OmopSketch package

- [`mockOmopSketch()`](https://OHDSI.github.io/OmopSketch/reference/mockOmopSketch.md)
  : Creates a mock database to test OmopSketch package.

### Characterisation

Characterise the database

- [`databaseCharacteristics()`](https://OHDSI.github.io/OmopSketch/reference/databaseCharacteristics.md)
  : Summarise Database Characteristics for OMOP CDM

- [`shinyCharacteristics()`](https://OHDSI.github.io/OmopSketch/reference/shinyCharacteristics.md)
  :

  Generate an interactive Shiny application that visualises the results
  obtained from the
  [`databaseCharacteristics()`](https://OHDSI.github.io/OmopSketch/reference/databaseCharacteristics.md)
  function.

### Helper functions

Functions to help populate and summariseClinicalRecords()

- [`clinicalTables()`](https://OHDSI.github.io/OmopSketch/reference/clinicalTables.md)
  : Tables in the cdm_reference that contain clinical information

### Deprecated functions

These functions have been deprecated

- [`summariseConceptCounts()`](https://OHDSI.github.io/OmopSketch/reference/summariseConceptCounts.md)
  **\[deprecated\]** : Summarise concept counts in patient-level data.
  Only concepts recorded during observation period are counted.

- [`summariseConceptSetCounts()`](https://OHDSI.github.io/OmopSketch/reference/summariseConceptSetCounts.md)
  : Summarise concept counts in patient-level data. Only concepts
  recorded during observation period are counted.

- [`plotConceptSetCounts()`](https://OHDSI.github.io/OmopSketch/reference/plotConceptSetCounts.md)
  **\[deprecated\]** :

  Plot the concept counts of a summariseConceptSetCounts output.
  **\[deprecated\]**

- [`summariseRecordCount()`](https://OHDSI.github.io/OmopSketch/reference/summariseRecordCount.md)
  **\[deprecated\]** : Summarise record counts of an omop_table using a
  specific time interval. Only records that fall within the observation
  period are considered.

- [`plotRecordCount()`](https://OHDSI.github.io/OmopSketch/reference/plotRecordCount.md)
  **\[deprecated\]** :

  Create a ggplot of the records' count trend. **\[deprecated\]**

- [`tableRecordCount()`](https://OHDSI.github.io/OmopSketch/reference/tableRecordCount.md)
  **\[deprecated\]** :

  Create a visual table from a summariseRecordCount() result.
  **\[deprecated\]**

- [`summariseInObservation()`](https://OHDSI.github.io/OmopSketch/reference/summariseInObservation.md)
  **\[deprecated\]** :

  Summarise the number of people in observation during a specific
  interval of time. **\[deprecated\]**

- [`plotInObservation()`](https://OHDSI.github.io/OmopSketch/reference/plotInObservation.md)
  **\[deprecated\]** :

  Create a ggplot2 plot from the output of summariseInObservation().
  **\[deprecated\]**

- [`tableInObservation()`](https://OHDSI.github.io/OmopSketch/reference/tableInObservation.md)
  **\[deprecated\]** :

  Create a visual table from a summariseInObservation() result.
  **\[deprecated\]**

# Articles

### Package functionalities

- [Summarise clinical tables
  records](https://OHDSI.github.io/OmopSketch/articles/summarise_clinical_tables_records.md):
- [Summarise concept id
  counts](https://OHDSI.github.io/OmopSketch/articles/summarise_concept_id_counts.md):
- [Summarise observation
  period](https://OHDSI.github.io/OmopSketch/articles/summarise_observation_period.md):
- [Summarise temporal trends in OMOP
  tables](https://OHDSI.github.io/OmopSketch/articles/summarise_trend.md):
- [Summarise the person
  table](https://OHDSI.github.io/OmopSketch/articles/summarise_person.md):
- [Summarise missing
  data](https://OHDSI.github.io/OmopSketch/articles/missing_data.md):
- [Summarise database
  characteristics](https://OHDSI.github.io/OmopSketch/articles/database_characteristics.md):
